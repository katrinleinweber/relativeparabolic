\begin{thm}\label{thm:BassKolster}
Let $\Phi$ be a classical root system of rank $\geqslant2$, let $R$ be arbitary commutative ring and $I$ be an ideal, satisfying the following condition:
\begin{itemize}
\item $\Phi=\rA_\ell$: $\sr(I)\leqslant\ell$,
\item $\Phi=\rB_\ell$: $\asr(R,I)\leqslant\ell-1$,
\item $\Phi=\rC_\ell$: $\sr(I)\leqslant2\ell$,
\item $\Phi=\rD_\ell$: $\asr(R,I)\leqslant\ell-1$.
\end{itemize}
Then the principal congruence subgroup $\G(\Phi,R,I)$ admits the following relative version of Bass---Kolster decomposition:
\[\G(\Phi,R,I)=\U(\Sigma^+,I)\ \U(\Sigma^-,I)\cdot \Z\cdot \U(\Sigma^-,I)\ \U(\Sigma^+,I)\cdot \G(\Delta,R,I), \]
where $\Sigma^\pm=\Phi^\pm\setminus\Delta$ and $\Z=\{ z_{-\alpha_\mathrm{max}}(r,1)\mid r\in I \}$.
\end{thm}
\begin{proof}
Let $g$ be an element of $\G(\Phi, R, I)$ and $e_1$ be the highest weight vector of the standard vector representation of $\G(\Phi, R, I)$.
It is clear that vector $v=g\cdot e_1$ is $I$-unimodular.

\textsc{Case $\Phi=\rA_\ell$:}
For $g\in\G(\rA_\ell,R,I)$ let $(1+r_1,r_2,\ldots,r_\ell,r_{\ell+1})^t\in\Um(\ell+1,R,I)$, $r_i\in I$ be its first column.
One can add the last entry to the first $\ell$ with some coefficients from $I$ to make then form a unimodular column of length $\ell$.
Then $\ell$ lower transformations (with coefficients from $I$) can make the last entry equal $r_1$.
Now apply $z_\gamma(-r_1,1)$, $\gamma=-\alpha_{\max}$:
\begin{multline*}
(1+r_1,r_2,\ldots,r_\ell,r_1)^t\xmapsto{x_{-\gamma}(-1)}(1,r_2,\ldots,r_\ell,r_1)^t\xmapsto{x_\gamma(-r_1)}\\\longmapsto(1,r_2,\ldots,r_\ell,0)^t\xmapsto{x_{-\gamma}(1)}(1,r_2,\ldots,r_\ell,0)^t.
\end{multline*}
Now $\ell-1$ lower transformations eliminates all the remaining entries in the first column, while $\ell$ more upper ones will make the first row trivial.

\textsc{Case $\Phi=\rC_\ell$:}
First column: $(1+r_1,r_2,\ldots,r_\ell,r_{-\ell},\ldots,r_{-1})^t\in\Um(2\ell,R,I)$. Find $c_1,\ldots,c_{-2}\in I$ such that $(1+r_1+c_1r_{-1},\ldots,r_{-2}+c_{-2}r_{-1})=(1+r_1',\ldots,r_{-2}')\in\Um(2\ell-1,R,I)$. First add $c_{-i}r_{-1}$ to $r_{-i}$ for $-i=-\ell,\ldots,-2$, so that
\[
\begin{pmatrix}
1+r_1 \\ r_i \\ r_{-i} \\ r_{-1}
\end{pmatrix}
\longmapsto
\begin{pmatrix}
1+r_1+\sum_{i=2}^\ell c_{-i}r_i\\ r_i \\ r_{-i}+c_{-i}r_{-1} \\ r_{-1}
\end{pmatrix}=
\begin{pmatrix}
1+r_{11} \\ r_i \\ r_{-i}' \\ r_{-1}
\end{pmatrix},\quad i=2,\ldots,\ell.
\]
Denote $\mathfrak{a}=\sum_{i=-\ell}^{-2} r_i'R\unlhd R$. Now add $c_ir_{-1}$ to $r_i$ for $i=2,\ldots,\ell$:
\[
\begin{pmatrix}
1+r_{11} \\ r_i' \\ r_{-i}' \\ r_{-1}
\end{pmatrix}
\longmapsto
\begin{pmatrix}
1+r_{11}+a \\ r_i+c_ir_{-1} \\ r_{-i}' \\ r_{-1}
\end{pmatrix}=
\begin{pmatrix}
1+r_{12} \\ r_i' \\ r_{-i}' \\ r_{-1}
\end{pmatrix},\quad
\begin{matrix*}[l]
a\in\mathfrak{a}\\
i=2,\ldots,\ell
\end{matrix*}
\]
Finally, add $\left(c_1+\sum_{i=2}^\ell c_ic_{-i}\right)r_{-1}$ to the first row:
\begin{multline*}
\left(1+r_1+\sum\nolimits_{i=2}^\ell c_{-i}r_i+a\right)+\left(c_1r_{-1}+\sum\nolimits_{i=2}^\ell c_ic_{-i}r_{-1}\right)=\\
=(1+r_1+c_1r_{-1})+\sum\nolimits_{i=2}^\ell c_{-i}(r_i+c_ir_{-1})+a=\\
=1+r_1'+\sum\nolimits_{i=2}^\ell c_{-i}r_i'+a=1+r_1''.
\end{multline*}
Note that $\langle 1+r_1'',r_2',\ldots,r_{-2}'\rangle=\langle 1+r_1',r_2',\ldots,r_{-2}'\rangle$, so we made the first $2\ell-1$ elements form a unimodular column.

Now we may assume that the first column $(1+r_1,\ldots,r_{-1})^t$ has its first $2\ell-1$ entries unimodular. Find $c_1,\ldots,c_{-2}\in I$ such that $c_1(1+r_1)+c_2r_2+\ldots+c_{-2}r_{-2}=r_1-r_{-1}$. Add $c_{-i}r_i$ to $r_{-1}$, $i=2,\ldots,\ell$:
\[
\begin{pmatrix}
1+r_1 \\ r_i \\ r_{-i} \\ r_{-1}
\end{pmatrix}
\longmapsto
\begin{pmatrix}
1+r_1 \\ r_i+c_{-i}r_1 \\ r_{-i} \\ r_{-1}+\sum_{i=2}^\ell c_{-i}r_{-i}
\end{pmatrix}=
\begin{pmatrix}
1+r_1 \\ r_i' \\ r_{-i} \\ r_{-11}
\end{pmatrix},\quad i=2,\ldots,\ell.
\]
Then add $c_ir_i'=c_i(r_1+c_{-i}r_{-i})$, $i=2,\ldots,\ell$ to $r_{-11}$:
\[
1+r_1\longmapsto 1+r_1,\quad r_{-11}\longmapsto r_{-1}+\sum_{i=2}^\ell c_{-i}r_{-i}+\sum_{i=2}^\ell c_i(r_i+c_{-i}r_1)=r_{-12}.
\]
Next add $(c_1-\sum_{i=2}^\ell c_ic_{-i})(1+r_1)$ to $r_{-12}$:
\begin{multline*}
r_{-12}\mapsto r_{-1}+\sum_{i=2}^\ell c_{-i}r_{-i}+\sum_{i=2}^\ell c_i(r_i+c_{-i}(1+r_1))+c_1(1+r_1)-\sum_{i=2}^\ell c_ic_{-i}(1+r_1)=\\=r_{-1}+c_1(1+r_1)+\sum_{i=2}^\ell(c_ir_i+c_{-i}r_{-i})=r_{-1}+(r_1-r_{-1})=r_1.
\end{multline*}
Again, as in case of $\rA_n$, apply $z_\gamma(-r_1,1)$ with $\gamma=-\alpha_\mathrm{max}$.
\[
\begin{pmatrix}1+r_1 \\ \vdots \\ r_1\end{pmatrix}
\xmapsto{x_{-\gamma}(-1)}
\begin{pmatrix}1 \\ \vdots \\ r_1\end{pmatrix}
\xmapsto{x_\gamma(-r_1)}
\begin{pmatrix}1 \\ \vdots \\ 0\end{pmatrix}
\xmapsto{x_{-\gamma}(1)}
\begin{pmatrix}1 \\ \vdots \\ 0\end{pmatrix}.
\]
Now apply $2\ell-2$ lower transformation to obtain zeroes on positions $i=2,\ldots,-2$, that will also add $\sum_{i=2}^\ell (r_i+r_{-i})$ to $r_{-1}$, so by one more transformation one can make the first column trivial. The same can be done with the first row, so in total we used $8\ell-3$ transformations.

\textsc{Case $\Phi=\rD_\ell$.} 
By Lemma~\ref{lemma:asrUnip} we can find $h_1\in \U(\Sigma^+_\ell, I)$ such that the upper half $v'^+$ of vector $v'=h_1\cdot v$ is $I$-unimodular.
Since $\sr(I)\leq \ell-1$ we can find $c_1$, $c_3, \ldots c_\ell \in I$ such that $(v''_1, v''_3, \ldots, v''_\ell) \in \Ums(\ell-1, R, I)$, where
$v''=h_2 \cdot t_{1,2}(c_1) \cdot v'$, $h_2=\prod\limits_{i=3}^\ell t_{i,2}(c_i)$.

We can find $f_1, f_3,\ldots, f_\ell \in R$ such that $f_1v''_1+\sum\limits_{i=3}^\ell f_i v''_{i} = 1$.
Set $\xi = v''_1-v''_{-2}-1 \in I$, $h_3 = t_{1,-2}(\xi f_1) \cdot \prod\limits_{i=3}^\ell t_{i,-2}(\xi f_i)$, $v'''=h_3 \cdot v''$.
Clearly, $v'''_{-2}=v'''_1-1$, therefore for $v_4 = z_{-\alpha_{max}}(-v'''_{-2}, 1) \cdot v'''$ one has $v^4_1 = 1$, as required.
On the other hand, $t_{1,2}(c_1) \cdot h_1 \in \U(\Phi^+, I)$, while $ h_3 \cdot h_2 \in \U(\Phi^-, I)$.

\textsc{Case $\Phi=\rB_\ell$:} Subdivide $v\in \Ums(2\ell+1, R, I)$ as $v=(v^+, v_0, v^-)\in R^\ell\times R\times R^\ell$.
Set $J = \mathfrak{J}(v^-) \leq I$.
Since $\sr(I/J)\leq l$ we can find $c_1,\dots,c_\ell\in I$ such that for $v' = h \cdot v$, $h = \prod\limits_{i=1}^\ell t_{0, i}(c_i) \in \U(\Phi^+, I)$
one has $\bar{v'}^+=(\bar{v'_1},\ldots, \bar{v'_\ell}) \in \Ums(\ell, R/J, I/J)$ and, therefore, $(v'^+, v'^-) \in \Ums(2\ell, R, I)$.
Now, it remains to repeat the argument for $\Phi=\rD_l$ (clearly, the maximal root of $\rD_\ell$ maps to the maximal root of $\rB_\ell$ with respect to the obvious embedding $\rD_\ell\subseteq\rB_\ell$).

%Let $(1+r_1,r_2,\dots,r_\ell,r_0,r_{-\ell},\dots,r_{-1})^t\in\Ums(2\ell+1,R,I)$ be the first column of $g$. 
%Find $c_1,\dots,c_\ell\in I$ such that $(1+r_1+c_1r_0,\dots,r_\ell+c_\ell r_0,r_{-\ell},\dots,r_{-1})$ is unimodular. 
%Apply $x_{\beta_k}(c_k)$ with $\beta_k=\alpha_k+\dots+\alpha_\ell$ for all $k=1,\dots,\ell$, and denote the resulting column by 
%$(1+r_1',\dots,r'_{-1})^t$.

%Note that $r'_i$ is not necessary equal to $r_i+c_ir_0$. 
%Denote also $\mathfrak{a}=r_{-\ell}R+\dots+r_{-1}R$, then one has $r'_{-\ell}R+\dots+r'_{-1}R=\mathfrak{a}$ and the ideal,
%generated by $1+r'_1,\dots,r'_\ell$ and $\mathfrak{a}$, is the whole $R$.

%Now $(1+r'_1,\dots,r'_\ell)^t$ is unimodular modulo $\mathfrak{a}$ and lies in the vector representation of $\G(\langle\alpha_1,\dots,\alpha_{\ell-1}\rangle)$ of type $\rA_{\ell-1}$. One can apply the case $\Phi=\rA_{\ell-1}$ to the pair $(R/\mathfrak{a},I/\mathfrak{a})$ and find $3\ell$ transformations that will transform the first half of the column into some $(1+s_1,s_2,\dots,s_\ell)^t$ which is congruent to $(1,0,\dots,0)^t$ modulo $\mathfrak{a}$. $(s_{-\ell},\dots,s_{-1})^t$ will denote these result of these transformations on $(r'_{-\ell},\dots,r_{-1})^t$.

%Since $\asr(R,I)\leqslant\ell-1$, there exist $c_{-\ell},\dots,c_{-2}$ such for
%\[ \mathfrak{b}=\langle s_{-\ell}+c_{-\ell}s_{-1},\dots,s_{-2}+c_{-2}s_{-1}\rangle=\langle s'_{-\ell},\ldots,s'_{-2}\rangle \]
%one has $\mathfrak{I}(\mathfrak{b})=\mathfrak{I}(\mathfrak{a})$. So $(1+s_1,s'_{-\ell},\ldots,s'_{-2})^t\in\Ums(\ell,R,I)$ and can be shortened to some 
%$(1+s''_1,s''_{-\ell},\ldots,s''_{-3})\in\Ums(\ell-1,R,I)$ with the help of $x_{\beta_i}$, $\beta_i=\alpha_2+\ldots+\alpha_i$, and $x_{\alpha_{\max}}$.
%Then one use $z_{\alpha_{\max}}$ to put $s''_1$ in position $-2$ and repeat endging of the previous cases.
\end{proof}