Let $\Phi$ be an irreducible root system of rank $\ell$.
In what follows, $r$ and $s$ are two distinct integers such that $1 \leq r, s \leq \ell$.
From Levi decomposition~\ref{rel:Levi-decomp} it follows that the following four subsets of $\E(\Phi, R, I)$ are equal:
\begin{multline*}
\U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot \E(\Delta_r, R, I) \cdot \EP_s(R, I) = \\
= \U(\Sigma_r, I)\cdot \U(\Sigma^-_r, I) \cdot \E(\Delta_r, R, I) \cdot \EP_s(R, I) = \hspace{5em} \\
\hspace{5em} = \EP_r(R, I) \cdot \E(\Delta_s, R, I) \cdot \U(\Sigma_s^-, I)\cdot \U(\Sigma_s, I) = \\
= \EP_r(R, I) \cdot \U(\Sigma^-_r \cap \Sigma^-_s, I) \cdot \EP_s(R, I).
\end{multline*}

\begin{dfn}
 Denote by $A_{rs}$ any of the above equal subsets.
 We call the decomposition of the form $\E(\Phi, R, I) = A_{rs}$ the {\it relative Dennis---Vaserstein} decomposition.
\end{dfn}

The main result of this subsection is the following theorem which is a relative version of \cite[Lemma~2.1]{ST76} and \cite[Theorem~2.5]{St78}).
\begin{thm}\label{thm:DennisVaserstein}
The relative elementary subgroup $\E(\Phi, R, I)$ admits Dennis---Vaserstein decomposition under the following assumptions on $I$.
\[\begin{array}{l@{\qquad}l@{\qquad}c@{\quad}c@{\qquad}l}
   & \Phi                                 & s    & r      & \text{ring condition} \\ \hline\vphantom{\Bigl(}
1. & \rA_\ell,\ \ell\geqslant 2            & 1    & \ell   & \sr(I) \leqslant \ell-1                         \\    
2. & \rB_\ell,\ \ell\geqslant 2            & 1    & \ell   & \sr(I) \leqslant \ell-1                         \\
3. & \rC_\ell,\ \ell \geqslant 2          & 1    & \ell   & \sr(I) \leqslant \ell-1,\ 2I+I^{\indexbox{2}}=I \\
4. & \rD_\ell,\ \ell\geqslant 4           & 1    & \ell   & \sr(I) \leqslant \ell-2                         \\ 
5. & \rD_\ell,\ \ell\geqslant 4           & \ell & \ell-1 & \sr(I) \leqslant 2                              \\
6. & \rE_\ell,\ \ell=6,7                  & \ell & 2      & \sr(I) \leqslant \ell-3                         \\ 
7. & \rE_\ell,\ \ell=6,7                  & \ell & 1      & \asr(I)\leqslant \ell-2                         \end{array}\]
\end{thm}
Consider the following two submonoids of $\E(\Phi, R)$:
\[ N_{rs} = \left\{ g\in \E(\Phi, R)\ \middle|\ g \cdot A_{rs} \cdot g^{-1} \subseteq A_{rs} \right\}, \quad
   L_{rs}=  \left\{ g\in \E(\Phi, R, I)\ \middle|\ g \cdot A_{rs} \subseteq A_{rs} \right\}. \]

It is easy to see that $N_{rs}$ normalizes $L_{rs}$, i.e. ${L_{rs}}^{N_{rs}} \subseteq L_{rs}$. 
Indeed, for $g\in N_{rs}$, $h\in L_{rs}$ one has
\begin{equation}\label{rel:NnormL} h^g \cdot A_{rs} = g^{-1} \cdot h \cdot g \cdot A_{rs} \subseteq g^{-1} \cdot h \cdot A_{rs} \cdot g \subseteq {A_{rs}}^g \subseteq A_{rs}.\end{equation}

\begin{lemma}\label{lemma:dv-normal} 
For every $\alpha \in \Delta_{\{r,s\}} \cup (\Phi^+ \setminus (\Sigma^+_r \cap \Sigma^+_s))$ one has $X_\alpha(R) \subseteq N_{rs}$. \end{lemma}
\begin{proof}
Notice that for every $i$ the factor $\EP_i(R, I)$ is normalized by $\EP_i(R)$, hence a fortiori it is normalized by $X_\alpha(R)$, $\alpha \in S_i^+$.
Since $\U(\Sigma_r^- \cap \Sigma_s^-, I)$ is normalized by $\E(\Delta_{\{r,s\}}, R)$ we obtain the assertion of the lemma for $\alpha \in \Delta_{\{r, s\}}$.

Now if $\alpha$ lies in $\Phi^+ \setminus \Sigma_r \cap \Sigma_s$ it is contained either in $\Delta_r$ or in $\Delta_s$.
Assume, for example, the latter. It remains to notice that $\U(\Sigma_r^- \cap \Sigma_s^-, I)^{X_\alpha(R)} \subseteq \U(\Sigma_s^-, I) \subseteq A_{rs}.$
\end{proof}

\begin{lemma}\label{lemma:dv_unipotent} For any $1\leq i\leq n$ the following statements hold. 
\begin{thmlist} \item \label{item-dvu1} $\U(\Phi^+, I) = X_{\alpha\ssub{i}}(I)\cdot \U(\Phi^+\setminus\{\alpha\ssub{i}\}, I) = \U(\Phi^+\setminus\{\alpha\ssub{i}\}, I)\cdot X_{\alpha\ssub{i}}(I)$.
\item \label{item-dvu2} For any $\xi\in R$ one has $\U(\Phi^+\setminus\{\alpha_i\}, I)^{x_{-\alpha\ssub{i}}(\xi)} \subseteq \U(\Phi^+, I)$.
\item \label{item-dvu3} $\U(\Phi^+, I)\cdot \U(\Phi^-, I) \subseteq \U(\Phi^+\setminus \{\alpha_i\}, I) \cdot \U(\Phi^-, I) \cdot X_{\alpha\ssub{i}}(I) \cdot X_{-\alpha\ssub{i}}(I)$.
\end{thmlist} \end{lemma}
\begin{proof} The first two statements easily follow from Chevalley commutator formula~\ref{rel:CCF} while the third one is a formal consequence of the first two. \end{proof}

%The following lemma is a relative version of the main reduction used by M.~Stein in~\cite{St78}
%for the proof of the absolute Dennis--Vaserstein decomposition.

\begin{lemma}\label{lemma:Stein_reduction}
Assume that there exists a subset $B \subseteq \E(\Delta_r, R, I)$ satisfying the following assumptions:
\begin{enumerate}
 \item\label{stein_cond1} One has $\U(\Sigma^+_r, I)\cdot \U(\Sigma^-_r, I) \cdot \E(\Delta_r, R, I) \subseteq \U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot B.$
 \item\label{stein_cond2} One has $X_{-\alpha\ssub{r}}(I)^B \subseteq \EP_s(R, I).$
\end{enumerate}
Then $X_{-\alpha_r}(R) \subseteq N_{rs}.$
\end{lemma}
\begin{proof}
Set $A:=\U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot B \cdot \EP_s(R, I).$
From the first assumption of the lemma it follows that $A_{rs}=A$.
On the other hand, by the second assumption we have
\begin{multline*}
X_{\alpha_r}(I) \cdot X_{-\alpha_r}(I) \cdot B \cdot \EP_s(R, I) \subseteq 
X_{\alpha_r}(I) \cdot B \cdot \EP_s(R, I) \cdot \EP_s(R, I) \subseteq \\
\subseteq B \cdot \U(\Sigma_r, I) \cdot \EP_s(R, I) =
B \cdot \EP_s(R, I).
\end{multline*}
Together with the third statement of~\cref{lemma:dv_unipotent} this implies that
\begin{equation*} \label{rel:sred}
A = \U(\Phi^+\setminus\{\alpha_r\}, I) \cdot \U(\Phi^-, I) \cdot B \cdot \EP_s(R, I).
\end{equation*}
%Consequently, from the second statement of~\cref{lemma:dv_unipotent} it follows that
%\begin{equation*} \label{rel:linv} X_{-\alpha\ssub{r}}(I) \cdot A \subseteq \U(\Phi^+, I) \cdot X_{-\alpha\ssub{r}}(I) \cdot \U(\Phi^-, I) \cdot B \cdot \EP_s(R, I) = A. \end{equation*}
Consequently, since $[B, X_{-\alpha_r}(R)] \subseteq \U(\Sigma_r^-, R) \cap \E(\Phi, R, I) = \U(\Sigma_r^-, I)$ we get that:
\begin{equation*} \label{rel:ninv} A^{X_{-\alpha\ssub{r}}(R)} = \U(\Phi^+, I) \cdot \U(\Phi^-, I) \cdot B ^{X_{-\alpha\ssub{r}}(R)} \cdot \EP_s(R, I) = A, \end{equation*}
which implies the assertion of the lemma.
%Clearly, the assertion of the lemma follows from~\ref{rel:linv}--\ref{rel:ninv}.
\end{proof}

Let us construct a set $B$ satisfying the assumptions of \cref{lemma:Stein_reduction} explicitly.

Denote by $\pi$ the irreducible representation of $G=\G(\Phi, R)$ on a free module $V$ with the highest weight $\varpi_s$.
The type of $\pi$ and the total number of weights in $\Lambda(\pi)$ are listed in Figure~\ref{fig:table}.

Clearly, after restricting the representation $(V, \pi)$ to the subgroup $G'=\G(\Delta_r, R)$ it becomes reducible.
Denote by $(V', \pi')$ the irreducible component corresponding to the same highest weight $\varpi_s \in \Lambda(\pi)$.

Consider the following subset of $\Lambda(\pi')$:
$$ \Gamma = \{\lambda \in \Lambda(\pi') \mid \lambda - \alpha_r \in \Lambda(\pi) \}.$$

The type of $\pi'$ and the number of elements in $\Lambda(\pi')$, $\Gamma$ are listed in Figure~\ref{fig:table}.

\begin{rem}
The sets $\Lambda(\pi')$, $\Gamma$ can be visualized using the technique of {\it weight diagrams} developed in~\cite{PSV98}.
In the simplest case of a microweight representation (i.\,e. a representation without zero weights)
the weight diagram of $(V, \pi)$ is just a graph whose vertices are in one-to-one correspondence with the elements of $\Lambda(\pi)$.
Two vertices $\lambda$, $\mu$ of the diagram are joined by a bond marked $i$ iff $\lambda-\mu = \alpha_i$.

The authors of~\cite{PSV98} put the vertex corresponding to the highest weight $\varpi_s$ of $\pi$ in the upper-left corner of the weight diagram.
Therefore the subset $\Lambda(\pi') \subseteq \Lambda(\pi)$ corresponds to the upper-left connected component of the graph obtained by removing all bonds marked $r$.
In turn, the set $\Gamma$ corresponds to the vertices of $\Lambda(\pi')$ incident to the removed bonds.
\end{rem}

\begin{figure}
\[\begin{array}{l @{\qquad} l @{\qquad} l @{\qquad} c @{\quad} c @{\qquad} l @{\qquad} l}
   & \Phi                                 & (s,r)         & |\Lambda(\pi)| & \text{type of $\pi$} & \text{type of $\pi'$}        & (|\Lambda(\pi')|, |\Gamma|)  \\ \hline\vphantom{\Bigl(}
1. & \rA_\ell,\ \ell\geqslant 2           & (1,\ell)      & \ell+1         & \text{natural}       & (\rA_{l-1}, \varpi_1)        & (\ell,1)  \\     
2. & \rB_\ell,\ \ell\geqslant 2           & (1,\ell)      & 2\ell+1        & \text{natural}       & (\rA_{l-1}, \varpi_1)        & (\ell,1) \\     
3. & \rC_\ell,\ \ell\geqslant 2           & (1,\ell)      & 2\ell          & \text{natural}       & (\rA_{l-1}, \varpi_1)        & (\ell,1)  \\
4. & \rD_\ell,\ \ell\geqslant 4           & (1,\ell)      & 2\ell          & \text{natural}       & (\rA_{l-1}, \varpi_1)        & (\ell,2)  \\ 
5. & \rD_\ell,\ \ell\geqslant 4           & (\ell,\ell-1) & 2^{\ell-1}     & \text{half-spinor}   & (\rA_{l-1}, \varpi_{\ell-1}) & (\ell,\ell-2)  \\
6. & \rE_\ell,\ \ell=6,7                  & (\ell,2)      & 27, 56         & \text{minimal}       & (\rA_{l-1}, \varpi_1)        & (\ell,3)  \\ 
7. & \rE_\ell,\ \ell=6,7                  & (\ell,1)      & 27, 56         & \text{minimal}       & (\rD_{l-1}, \varpi_1)        & (2\ell-2,\ell-1)  \end{array}\]
 \caption[Table]{List of representation involved in the proof of~\cref{thm:DennisVaserstein}.} \label{fig:table}
\end{figure}

Now let $B$ be the set of all elements $g$ of $\E(\Delta_r,R, I)$ such that $(g \cdot v^+)_\lambda = 0$ for all $\lambda\in\Gamma$.
Applying~\cref{lemma:uraction} to the subsystem $\Delta_r$ we find
$x\in\U(\Delta_r^+, I)$, $y\in \U(\Delta_r^-, I)$ such that $yx\cdot g \in B$.
This proves the first assumption of Lemma~\ref{lemma:Stein_reduction}, indeed:
\[ \U(\Sigma^+_r, I) \cdot \U(\Sigma^-_r, I) \cdot g = \U(\Sigma^+_r, I) x^{-1} \cdot \U(\Sigma^-_r, I)^{x^{-1}} y^{-1} (yxg) \subseteq \U(\Phi^+, I) \cdot \U(\Phi^-, I) \cdot B. \]
To prove the second assumption of Lemma~\ref{lemma:Stein_reduction} notice that by the definition of $\Gamma$ and by~\cref{lemma:Matsumoto} for any $s\in I$, $ g\in B$ one has $x_{-\alpha_r}(s) \cdot g \cdot v^+ = g \cdot v^+$ hence
\[ X_{-\alpha\ssub{r}}(I)^{B} \subseteq \U(\Phi^-, I) \cap \Stab(v^+) \subseteq \U(\Delta_s^-, I) \subseteq \EP_s(R, I). \]

\begin{proof}[Proof of Theorem~\ref{thm:DennisVaserstein}]
By the above discussion we may assume that the assertion of~\cref{lemma:Stein_reduction} holds.
Set $\Pi' = \Pi \setminus \{\alpha_s\}$.
From~\cref{lemma:dv-normal} and \cref{lemma:Stein_reduction} it follows that $X_\alpha(R) \subseteq N_{rs}$ for $\alpha \in \Pi' \cup -\Pi'$.
Since $\Delta_s$ is irreducible in all the cases under consideration we get from~\cref{item-egen} that $\E(\Delta_s, R) \subseteq N_{rs}$.

Our next step is to show that $\U(\Sigma_s, R) \subseteq N_{rs}$.
First of all, notice that by~\cref{lemma:dv-normal} we have that $X_{\alpha_s}(R) \subseteq N_{rs}$.
In the case $\Phi\neq \rB_\ell, \rC_\ell$ all roots of $\Sigma^+_s$ have the same $s$-shape and length therefore the needed statement follows from~\cref{item-trans2}.
In the case $\Phi=\rB_\ell$ the above argument only shows that $\U(\Sigma_s^{+>}, R) \subseteq N_{rs}$ and a separate argument is needed for the root subgroup corresponding to the sole short root of $\Sigma_s^+$.
Specializing identity~\eqref{rel:CCF} we get:
\begin{equation*} \label{rel:CCF-specBC} x_{1,0}(ab) = [x_{1, 2}(a), x_{2, 0}(b)] \cdot x_{1,-2}(-a b^2) \end{equation*}
The root subgroup $X_{2, 0}(R)$ is contained in $\E(\Delta_s, R) \subseteq N_{rs}$.
On the other hand, by the above argument we know that $X_{1,-2}(R) \subseteq N_{rs}$, therefore $X_{1,0}(R) \subseteq N_{rs}$ and $\U(\Sigma_s, R) \subseteq N_{rs}$.
The case $\Phi=\rC_\ell$ will be analyzed separately below (see~\cref{lemma:DVcaseCl}).

Our ultimate goal is to show the inclusion $\E(\Phi, R, I) \subseteq L_{rs}$. 
By~\cref{prop:Stepanov} it is enough to prove that $\mathcal{Z}(\Sigma^-_s) \subseteq L_{rs}$.
In fact, in view of formula~\eqref{rel:NnormL} and the previous part of the proof it suffices to show only that $\mathcal{X} \subseteq L_{rs}$.
It is obvious that $\EP_r(R, I) \subseteq L_{rs}$.
From $\EP_s(R, I) \subseteq \EP_s(R) \subseteq N_{rs}$ we also conclude that $\EP_s(R, I) \subseteq L_{rs}$. Indeed, for $g\in\EP_s(R,I)$ one has
\[ gA_{rs} \subseteq g {A_{rs}}^g = A_rs g = A_rs. \]
Thus, we are left to prove the inclusion $\U(\Sigma^-_r \cap \Sigma^-_s, I) \subseteq L_{rs}$.

Just as in the above argument all the cases except $\Phi = \rB_\ell, \rC_\ell$ follow from~\cref{item-trans2}.
In the case $\Phi=\rB_\ell$ from $x_{0, 1}(-a) = [x_{2,1}(-a), x_{0, 2}(-1)]\cdot x_{-2,1}(a)$ we conclude that
$$X_{0,1}(I) \subseteq X_{2,1}(I) \cdot X_{2,1}(I)^{x_{0,2}(1)} \cdot X_{-2,1}(I) \subseteq L_{rs} \cdot L_{rs}^{N_{rs}} \cdot L_{rs} \subseteq L_{rs},$$
whence the statement of the theorem follows. \end{proof}

\begin{lemma} \label{lemma:DVcaseCl}
 
\end{lemma}

