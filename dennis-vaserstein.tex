Let $\Phi$ be an irreducible root system of rank $\ell$ and let $1\leq r,s \leq \ell$ be two distinct integers.
From Levi decomposition~\ref{rel:Levi-decomp} it follows that the following four subsets of $\E(\Phi, R, I)$ are equal:
\begin{multline*}
\U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot \E(\Delta_r, R, I) \cdot \EP_s(R, I) = \\
= \U(\Sigma_r, I)\cdot \U(\Sigma^-_r, I) \cdot \E(\Delta_r, R, I) \cdot \EP_s(R, I) = \hspace{5em} \\
\hspace{5em} = \EP_r(R, I) \cdot \E(\Delta_s, R, I) \cdot \U(\Sigma_s^-, I)\cdot \U(\Sigma_s, I) = \\
= \EP_r(R, I) \cdot \U(\Sigma^-_r\cap \Sigma^-_s, I) \cdot \EP_s(R, I).
\end{multline*}

\begin{lemma}\label{lemma:dv-normal} The set $A_{rs}$ is normalized by the subgroup $\EP_{\{r,s\}}(R) \leq \E(\Phi, R)$. \end{lemma}

\begin{dfn}
 Denote by $A_{rs}$ any of the above equal subsets.
 We call the decomposition of the form $\E(\Phi, R, I) = A_{rs}$ the {\it relative Dennis---Vaserstein} decomposition.
\end{dfn}

The main result of this subsection is the following theorem which is a relative version of \cite[Lemma~2.1]{ST76} and \cite[Theorem~2.5]{St78}).
\begin{thm}\label{thm:DennisVaserstein}
The relative elementary subgroup $\E(\Phi, R, I)$ admits Dennis---Vaserstein decomposition under the following assumptions on $I$.
\[\begin{array}{l@{\qquad}c@{\quad}c@{\qquad}l}
\Phi & s & r & \text{ring condition} \\ \hline\vphantom{\Bigl(}
\rA_\ell, \rB_\ell,\ \ell\geqslant 2 & 1 & \ell & \sr(I) \leqslant \ell-1 \\     
\rC_\ell,\ \ell \geqslant 2          & 1 & \ell & \sr(I) \leqslant \ell-1 \\
\rD_\ell,\ \ell\geqslant 4           & 1 & \ell & \sr(I) \leqslant \ell-2 \\ 
\rD_\ell,\ \ell\geqslant 4           & \ell & \ell-1 & \sr(I) \leqslant 2 \\
\rE_\ell,\ \ell=6,7             & \ell & 2 & \sr(I) \leqslant \ell-3 \\ 
\rE_\ell,\ \ell=6,7             & \ell & 1 & \asr(I)\leqslant \ell-2
\end{array}\]
\end{thm}
%Consider the usual conjugation action of $\E(\Phi, R)$ on $\E(\Phi, R, I)$. 
%This action induces an action of $\E(\Phi, R)$ on the set $\mathfrak{S}$ of all subsets of $\E(\Phi, R, I)$.
%On the other hand, $\E(\Phi, R, I)$ acts on $\mathfrak{S}$ by left multiplication.
%Denote by $N_{rs}$ and $L_{rs}$ stabilizers of $A_{rs} \in \mathfrak{S}$ with respect to these actions.
Consider the following two subsets of $\E(\Phi, R)$:
\[ N_{rs} = \left\{ g\in \E(\Phi, R)\ \middle|\ g \cdot A_{rs} \cdot g^{-1} = A_{rs} \right\}, \quad
   L_{rs}=  \left\{ g\in \E(\Phi, R, I)\ \middle|\ g \cdot A_{rs} \subseteq A_{rs} \right\}. \]

It is easy to see that $N_{rs}$ normalizes $L_{rs}$, i.e. ${L_{rs}}^{N_{rs}} \subseteq L_{rs}$. 
Indeed, for $g\in N_{rs}$, $h\in L_{rs}$ one has
$$h^g \cdot A_{rs} = g^{-1} \cdot h \cdot g \cdot A_{rs} = g^{-1} \cdot h \cdot A_{rs} \cdot g \subseteq {A_{rs}}^g = A_{rs}.$$

\begin{lemma}\label{lemma:dv_unipotent} For any $1\leq i\leq n$ the following statements hold. 
\begin{thmlist} \item \label{item-dvu1} $\U(\Phi^+, I) = X_{\alpha\ssub{i}}(I)\cdot \U(\Phi^+\setminus\{\alpha\ssub{i}\}, I) = \U(\Phi^+\setminus\{\alpha\ssub{i}\}, I)\cdot X_{\alpha\ssub{i}}(I)$.
\item \label{item-dvu2} For any $\xi\in R$ one has $\U(\Phi^+\setminus\{\alpha_i\}, I)^{x_{-\alpha\ssub{i}}(\xi)} \subseteq \U(\Phi^+, I)$.
\item \label{item-dvu3} $\U(\Phi^+, I)\cdot \U(\Phi^-, I) \subseteq \U(\Phi^+\setminus \{\alpha_i\}, I) \cdot \U(\Phi^-, I) \cdot X_{\alpha\ssub{i}}(I) \cdot X_{-\alpha\ssub{i}}(I)$.
\end{thmlist} \end{lemma}
\begin{proof} The first two statements easily follow from Chevalley commutator formula~\ref{rel:CCF} while the third one is a formal consequence of the first two. \end{proof}

%The following lemma is a relative version of the main reduction used by M.~Stein in~\cite{St78}
%for the proof of the absolute Dennis--Vaserstein decomposition.

\begin{lemma}\label{lemma:Stein_reduction}
Assume that there exists a subset $B \subseteq \E(\Delta_r, R, I)$ satisfying the following assumptions:
\begin{enumerate}
 \item\label{stein_cond1} One has $\U(\Sigma^+_r, I)\cdot \U(\Sigma^-_r, I) \cdot \E(\Delta_r, R, I) \subseteq \U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot B.$
 \item\label{stein_cond2} One has $X_{-\alpha\ssub{r}}(I)^B \subseteq \EP_s(R, I).$
\end{enumerate}
Then $X_{-\alpha_r}(I) \subseteq L_{rs}$ and $\EP_s(R) \subseteq N_{rs}.$
\end{lemma}
\begin{proof} Set $A:=\U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot B \cdot \EP_s(R, I).$
From the first assumption of the lemma it follows that $A_{rs}=A$.
On the other hand, by the second assumption we have
\begin{multline*} X_{\alpha_r}(I) \cdot X_{-\alpha_r}(I) \cdot B \cdot \EP_s(R, I) \subseteq 
 X_{\alpha_r}(I) \cdot B \cdot \EP_s(R, I) \cdot \EP_s(R, I) \subseteq \\
 \subseteq B \cdot \U(\Sigma_r, I) \cdot \EP_s(R, I) \subseteq 
 B \cdot \EP_s(R, I). \end{multline*}
Together with the third statement of~\cref{lemma:dv_unipotent} this implies that
\begin{equation} \label{rel:sred} A = \U(\Phi^+\setminus\{\alpha_r\}, I) \cdot \U(\Phi^-, I) \cdot B \cdot \EP_s(R, I). \end{equation}
Consequently, from the second statement of~\cref{lemma:dv_unipotent} it follows that
\begin{equation} \label{rel:linv} X_{-\alpha\ssub{r}}(I) \cdot A \subseteq \U(\Phi^+, I) \cdot X_{-\alpha\ssub{r}}(I) \cdot \U(\Phi^-, I) \cdot B \cdot \EP_s(R, I) = A. \end{equation}
Since $[B, X_{-\alpha_r}(R)] \subseteq \U(\Sigma_r^-, R) \cap \E(\Phi, R, I) = \U(\Sigma_r^-, I)$ we also get that:
\begin{equation} \label{rel:ninv} A^{X_{-\alpha\ssub{r}}(R)} = \U(\Phi^+, I) \cdot \U(\Phi^-, I) \cdot B ^{X_{-\alpha\ssub{r}}(R)} \cdot \EP_s(R, I) = A. \end{equation}

To prove the second part of the statement observe first that $\EP_s(R)$ is generated by $X_{\alpha\ssub{i}}(R)$ for $1\leqslant i\leqslant n$ and $X_{-\alpha\ssub{i}}(R)$ for $i\neq s$.
%TODO: Find proper reference for this fact
From \ref{rel:ninv} it follows that $X_{-\alpha_r}(R)\subseteq N_{rs}$.
On the other hand, inclusions $X_{\alpha\ssub{k}}(R) \subseteq N_{rs}$ for $\ 1\leqslant k\leqslant \ell$ and $X_{-\alpha\ssub{k}}(R) \subseteq N_{rs}$ for $k\neq r,s$ are obvious.
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:DennisVaserstein}]
We first show that the assumed stability conditions on $I$ imply the assumptions of Lemma~\ref{lemma:Stein_reduction}.
Consider the following two subsets of $\Lambda(\pi)$:
$$\Gamma = \varpi_s- (\Sigma_s^+\cap \Delta_r),\quad \Gamma_0 = \{\lambda \in \Gamma \mid \lambda - \alpha_r \in \Lambda(\pi) \}.$$
With the choice of $s$ as in the assumption, $\Gamma$ is the set of weights of an irreducible representation of $\G(\Delta_r, R)$ corresponding to the same highest weight $\varpi_s$.
The subsystem $\Delta_r$ has type $\rA_{\ell-1}$ in all cases except the last one.
It is also clear that $|\Gamma_0|=1$ for $\Phi=\rA_\ell, \rB_\ell$, $|\Gamma_0|=2$ for $\Phi=\rD_\ell$, and $|\Gamma_0|=3$ in case $\Phi=\rE_\ell$ and $r=2$.
If $\Phi=\rE_\ell$, $r=1$, the subsystem $\Delta_r$ has type $\rD_{\ell-1}$ and $|\Gamma_0|=\ell-1$.

%TODO: PICK AS L_r!!!
Let $B$ be the set of all elements $g$ of $\E(\Delta_r,R, I)$ such that $(g \cdot v^+)_\lambda = 0$ for $\lambda\in\Gamma_0$.
In any of  the specified cases the assumption on $I$ allows us to apply Lemma~\ref{lemma:uraction} to the subsystem $\Delta_r$ and find
$x\in\U(\Delta_r\cap\Phi^+, I)$, $y\in \U(\Delta_r\cap\Phi^-, I)$ such that $yx\cdot g \in B$.
This proves the first condition of Lemma~\ref{lemma:Stein_reduction}, indeed:
\[ \U(\Sigma^+_r, I) \U(\Sigma^-_r, I) \cdot g = \U(\Sigma^+_r, I) x^{-1} \cdot \U(\Sigma^-_r, I)^{x^{-1}} y^{-1} (yxg) \subseteq \U(\Phi^+, I) \U(\Phi^-, I) B. \]
To prove the second assumption of Lemma~\ref{lemma:Stein_reduction} notice that by the definition of $\Gamma_0$ for any $s\in I$, $ g\in B$ one has $x_{-\alpha_r}(s) \cdot g \cdot v^+ = g \cdot v^+$ hence
\[ X_{-\alpha\ssub{r}}(I)^{B} \subseteq \U(\Phi^-, I) \cap \Stab(v^+) \subseteq \E(\Delta_s, R, I) \subseteq \EP_s(R, I). \]

From now on we can assume that the conclusion of Lemma~\ref{lemma:Stein_reduction} holds and $\EP_s$ normalizes $A_{rs}$.
Notice that in view of~\cref{prop:Stepanov} it suffices to show that the following two families of elements are contained in $L_{rs}$:
\begin{itemize} \item $z_{\alpha}(s, \xi)$, $s\in I$, $\xi \in R$, $\alpha\in\Sigma^-_s$;
\item $x_{\beta}(s)$, $s \in I$, $\beta \in \Phi$. \end{itemize}
Since $\EP_s \subseteq N_{rs}$, the inclusions for the first family of elements follow from those for the second one.
We already know that $\U(\Phi^+, I) \subseteq L_{rs}$, hence it only suffices to show $\U(\Phi^-, I) \subseteq L_{rs}$.

Notice that the Weyl group $W(\Delta_s)$ acts transitively on $\Delta_s$, therefore in view of relation~\ref{rel:R3} the subgroup
$W_s := \langle w_\alpha(1) \mid \alpha\in\Delta_s\rangle \leqslant \EP_s$ acts transitively on the set of root subgroups $X_\alpha(I)$, $\alpha\in \Delta_s$
and we get that that $\U(\Delta_s \cap \Phi^-, I)\subseteq L_{rs}$.

%Now denote by $\widetilde{\alpha}$ the maximal root of $\Phi$.
By our assumptions on $\Phi$ we have $m_s(\alpha\ssub{\mathrm{max}})=1$, hence every two roots $\alpha, \beta \in \Sigma^-_s$ of the same length
have the same $s$-shape and
%(i.\,e. $\shape(\{s\}, \alpha = \shape(\{s\}, \beta)$).
hence by Lemma~\ref{lemma:abs} are interchanged by the action of $W(\Delta_s)$. % $\alpha$ and $\beta$ if their length is equal.
%By the same argument as above we get that $W(\Delta_s)$.
Since $X_{\alpha\ssub{s}} \subseteq L_{rs}$ by the same argument as above, we get $\U({\Sigma^-_s}^>, I)\subseteq L_{rs}$.
This completes the proof of the theorem for $\Phi\neq \rB_\ell$. 

In the case $\Phi=\rB_\ell$ we have to show additionally that $X_{-\alpha^<_{\mathrm{max}}}(I) \leqslant L_{rs}$, where $\alpha^<_{\mathrm{max}}$
denotes the maximal short root of $\rB_\ell$.
By Chevalley commutator formula we have
\[ x_{-{\alpha^<_{\mathrm{max}}}}(s) = x_{-1,0}(s) = x_{1,-2}(s) \cdot x_{-1,-2}(-s)^{x_{-2, 0}(-1)} \cdot x_{-1, 2}(\xi),\ s\in I. \]
On the other hand, $x_{-2,0}(1) \in \EP_s$, and we have already shown $X_{-1,-2}(I), X_{-1, 2}(I) \subseteq L_{rs}$.
This concludes the proof of the theorem.
\end{proof}
