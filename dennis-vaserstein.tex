Throughout the present section we denote by $\EP_s(R, I)$ the subgroup $\E(\Delta_s, R, I) \cdot \U(\Sigma_s, I)$, $1 \leq s \leq n$.
%TODO: Add Levi decomposition to preliminaries
%TODO: Introduce notation for U(S, R)
Set $\EP_s := \EP_s(R, R) = \E(\Delta_s, R) \cdot \U(\Sigma_s, R)$. 

Let $\Phi$ be an irreducible root system of rank $\ell$.
Let $r$, $s$ be two distinct indices $1\leq r,s \leq \ell$.
From Levi decomposition it follows that
\begin{multline}\nonumber \U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot \E(\Delta_r, R, I) \cdot \EP_s(R, I) = 
\U(\Sigma_r, I)\cdot \U(\Sigma^-_r, I) \cdot \E(\Delta_r, R, I) \cdot \EP_s(R, I) = \\
= \EP_r(R, I) \cdot \E(\Delta_s, R, I) \cdot \U(\Sigma_s^-, I)\cdot \U(\Sigma_s, I) = 
\EP_r(R, I) \cdot \U(\Sigma^-_r\cap \Sigma^-_s, I) \cdot \EP_s(R, I). \end{multline}
Denote by $A_{rs}$ any of the equal subsets from the previous formula. 

\begin{thm}\label{theorem:relative_dv}
The relative elementary subgroup $\E(\Phi, R, I)$ coincides with $A_{rs}$ under the following assumptions on $(R, I)$.
  \begin{center}
    \begin{tabular}{| l | l | l | l | l |} \hline
    â„– & $\Phi$ & $(s,r)$ & ring condition \\ \hline
    1. & $\rA_\ell$, $\ell\geq 2$ & $(1, \ell)$ & $\sr(I) \leq \ell-1$ \\ \hline
    2. & $\rB_\ell$, $\ell\geq 3$ & $(1, \ell)$ & $\sr(I) \leq \ell-1$ \\ \hline
    3. & $\rD_\ell$, $\ell\geq 4$ & $(1, \ell)$ & $\sr(I) \leq \ell-2$ \\ \hline    
    4. & $\rE_\ell$, $\ell=6,7$ & $(\ell, 2)$ & $\sr(I) \leq \ell-3$ \\ \hline     
    5. & $\rE_\ell$, $\ell=6,7$ & $(\ell, 1)$ & $\asr(R, I)\leq \ell-2$ \\ \hline    
    \end{tabular} \end{center} 
\end{thm}
The proof of Theorem~\ref{theorem:relative_dv} occupies the rest of this section.

Consider the usual conjugation action of $\E(\Phi, R)$ on $\E(\Phi, R, I)$. 
This action induces an action of $\E(\Phi, R)$ on the set $\mathfrak{S}$ of all subsets of $\E(\Phi, R, I)$.
On the other hand, $\E(\Phi, R, I)$ acts on $\mathfrak{S}$ by left multiplication.
Denote by $N_{rs}$ and $L_{rs}$ stabilizers of $A_{rs} \in \mathfrak{S}$ with respect to these actions.
In other words $$N_{rs} = \{ g\in \E(\Phi, R) \mid g \cdot A_{rs} \cdot g^{-1} \subseteq A_{rs} \};\quad L_{rs}= \{ g\in \E(\Phi, R, I) \mid g \cdot A_{rs} \subseteq A_{rs} \}.$$

It is easy to see that $N_{rs}$ normalizes $L_{rs}$. Indeed, for $g\in N_{rs}$, $h\in L_{rs}$ one has
$$h^g \cdot A_{rs} = g^{-1} \cdot h \cdot g \cdot A_{rs} \subseteq g^{-1} \cdot h \cdot A_{rs} \cdot g \subseteq A_{rs}^g \subseteq A_{rs}.$$

\begin{lemma}\label{lemma:dv_unipotent} For any $1\leq i\leq n$ the following statements hold. \begin{enumerate} 
\item $\U(\Phi^\pm, I) = X_{\pm\alpha\ssub{i}}(I)\cdot \U(\Phi^\pm\setminus\{\pm\alpha\ssub{i}\}, I) = \U(\Phi^\pm\setminus\{\pm\alpha\ssub{i}\}, I)\cdot X_{\pm\alpha\ssub{i}}(I).$
\item For any $\xi\in R$ one has $\U(\Phi^\pm\setminus\{\alpha_i\}, I)^{x_{\mp\alpha\ssub{i}}(\xi)^{-1}} \subseteq \U(\Phi^\pm, I).$
\item $\U(\Phi^+, I)\cdot \U(\Phi^-, I) \subseteq \U(\Phi^+\setminus \{\alpha_i\}, I) \cdot \U(\Phi^-, I) \cdot X_{\alpha\ssub{i}}(I) \cdot X_{-\alpha\ssub{i}}(I)$.
\end{enumerate} \end{lemma}
\begin{proof}
 The first two statements easily follow from Chevalley commutator formula while the third one is a formal consequence of the first two.
\end{proof}

The following lemma is a relative version of the main reduction used by M.~Stein in~\cite{St78} for the proof of the absolute Dennis--Vaserstein decomposition.
\begin{lemma}\label{lemma:Stein_reduction}
Assume that there exists a subset $\widetilde{L_r} \subseteq \E(\Delta_r, R, I)$ with the following properties:
\begin{enumerate}[label=(\alph*)] 
 \item\label{stein_cond1} One has $\U(\Sigma^+_r, I)\cdot \U(\Sigma^-_r, I) \cdot \E(\Delta_r, R, I) \subseteq \U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot \widetilde{L_r}.$
 \item\label{stein_cond2} One has $X_{-\alpha\ssub{r}}(I)^{\widetilde{L_r}} \subseteq \EP_s(R, I).$
\end{enumerate}
Then $X_{-\alpha_r}(I) \subseteq L_{rs}$ and $\EP_s \subseteq N_{rs}.$
\end{lemma}
\begin{proof} Set $A:=\U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot \widetilde{L_r} \cdot \EP_s(\Phi, R, I).$
From condition~\ref{stein_cond1} of the lemma it follows that $A_{rs}=A$.
Observe that from Lemma~\ref{lemma:dv_unipotent} and condition~\ref{stein_cond2} it follows that
\begin{multline}\nonumber 
A \subseteq \U(\Phi^+\setminus \{\alpha_r\}, I) \cdot \U(\Phi^-, I) \cdot X_{\alpha\ssub{r}}(I) \cdot X_{-\alpha\ssub{r}}(I) \cdot \widetilde{L_r} \cdot \EP_s(R, I) \subseteq \\ 
\subseteq \U(\Phi^+\setminus\{\alpha_r\}, I) \cdot \U(\Phi^-, I) \cdot X_{\alpha\ssub{r}}(I) \cdot X_{-\alpha\ssub{r}}(I) \cdot \widetilde{L_r} \cdot \EP_s(R, I) \subseteq \\
\subseteq \U(\Phi^+\setminus\{\alpha_r\}, I) \cdot \U(\Phi^-, I) \cdot \widetilde{L_r} \cdot \U(\Sigma_r, I) \cdot \EP_s(R, I)  \cdot \EP_s(R, I) \subseteq \\
\subseteq \U(\Phi^+\setminus\{\alpha_r\}, I) \cdot \U(\Phi^-, I) \cdot \widetilde{L_r} \cdot \EP_s(R, I). \end{multline}
Applying Lemma~\ref{lemma:dv_unipotent} we get that:
\begin{equation}\nonumber A^{X_{-\alpha\ssub{r}}} \subseteq \U(\Phi^+, I) \cdot \U(\Phi^-, I) \cdot \widetilde{L_r} ^{X_{-\alpha\ssub{r}}} \cdot \EP_s(R, I) \subseteq A. \end{equation}
\begin{equation}\nonumber X_{-\alpha\ssub{r}}(I) \cdot A \subseteq \U(\Phi^+, I) \cdot X_{-\alpha\ssub{r}}(I) \cdot \U(\Phi^-, I) \cdot \widetilde{L_r} \cdot \EP_s(R, I) = A. \end{equation}
To prove the second part of the statement observe first that $\EP_s$ is generated by $X_{\alpha\ssub{i}}$ for $1\leq i\leq n$ and $X_{-\alpha\ssub{i}}$ for $i\neq s$.
%TODO: Find proper reference for this fact
We have just shown that $X_{-\alpha_r}\subseteq N_{rs}$.
On the other hand, inclusions $X_{\alpha\ssub{k}} \subseteq N_{rs}$ for $\ 1\leq k\leq \ell$ and $X_{-\alpha\ssub{k}} \subseteq N_{rs}$ for $k\neq r,s$ are obvious.
\end{proof}

\begin{proof}[Proof of Theorem~\ref{theorem:relative_dv}]
We first show that under specified assumptions on $(R, I)$ one can meet the conditions of Lemma~\ref{lemma:Stein_reduction}.
Consider the following two subsets of $\Lambda(\pi)$:
$$\Gamma = \varpi_s- (\Sigma_s^+\cap \Delta_r),\quad \Gamma_0 = \{\lambda \in \Gamma \mid \lambda - \alpha_r \in \Lambda(\pi) \}.$$
Clearly, $\Gamma$ is the set of weights of an irreducible representation of $\G(\Delta_r, R)$ corresponding to the same highest weight $\varpi_s$.
The subsystem $\Delta_r$ has type $\rA_{\ell-1}$ in all cases except the last one.
It is also clear that $|\Gamma_0|=1$ for $\Phi=\rA_\ell, \rB_\ell$, $|\Gamma_0|=2$ for $\Phi=\rD_\ell$, $|\Gamma_0|=3$ for $\Phi=\rE_\ell$ and $r=2$.
In the case $\Phi=\rE_\ell$, $r=2$ the subsystem $\Delta_r$ has type $\rD_{\ell-1}$ and $|\Gamma_0|=\ell-1$.

Let $\widetilde{L_r}$ be the set of all elements $g$ of $\E(\Delta_r,R, I)$ such that $(g \cdot v^+)_\lambda = 0$ for $\lambda\in\Gamma_0$.
In any of specified cases the assumption on $(R, I)$ allows us to apply Lemma~\ref{lemma:uraction} to the subsystem $\Delta_r$ and find
$x\in\U(\Delta_r\cap\Phi^+, I)$, $y\in \U(\Delta_r\cap\Phi^-, I)$ such that $yx\cdot g \in \widetilde{L_r}$.
This proves the first condition of Lemma~\ref{lemma:Stein_reduction}, indeed:
$$ \U(\Sigma^+_r, I)\cdot \U(\Sigma^-_r, I) \cdot g = \U(\Sigma^+_r, I) x^{-1} \cdot \U(\Sigma^-_r, I)^{x^{-1}} y^{-1} \cdot (yxg) \subseteq \U(\Phi^+, I)\cdot \U(\Phi^-, I) \cdot \widetilde{L_r}.$$
To prove the second condition notice that by the definition of $\Gamma_0$ for any $s\in I$, $ g\in\widetilde{L_r}$ one has $x_{-\alpha_r}(s) \cdot g \cdot v^+ = g \cdot v^+$ and, therefore,
$$X_{-\alpha\ssub{r}}(I)^{\widetilde{L_r}} \subseteq \U(\Phi^-, I) \cap \Stab(v^+) \subseteq \E(\Delta_s, R, I) \subseteq \EP_s(R, I).$$

From now on we can assume that the statement of Lemma~\ref{lemma:Stein_reduction} holds and $\EP_s$ normalizes $A_{rs}$.
Notice that in view of Theorem~\ref{theorem:Stepanov} it suffices to show that the following two families of elements are contained in $L_{rs}$:
\begin{itemize} \item $z_{\alpha}(s, \xi)$, $s\in I$, $\xi \in R$, $\alpha\in\Sigma^-_s$;
\item $x_{\beta}(s)$, $s \in I$, $\beta \in \Phi$. \end{itemize}
Since $\EP_s \subseteq N_{rs}$ it suffices to check inclusions only for the second family of elements.
We already know that $\U^+(\Phi, I) \subseteq L_{rs}$.

Notice that the Weyl group $W(\Delta_s)$ acts transitively on $\Delta_s$, therefore in view of relation~\ref{rel:R3} the subgroup
$W_s := \langle w_\alpha(1) \mid \alpha\in\Delta_s\rangle \leq \EP_s$ acts transitively on the set of root subgroups $X_\alpha(I)$, $\alpha\in \Delta_s$.
Since $X_{-\alpha\ssub{r}}(I) \subseteq L_{rs}$ we get that that $\U(\Delta_s \cap \Phi^-, I)\subseteq L_{rs}$.

Now denote by $\widetilde{\alpha}$ the maximal root of $\Phi$. Our assumptions on $\Phi$ guarantee that $m_s(\widetilde{\alpha})=1$, 
and, consequently, every two roots $\alpha, \beta \in \Sigma^-_s$ have the same $s$-shape (i.\,e. $\shape(\{s\}, \alpha = \shape(\{s\}, \beta)$).
By Lemma~\ref{lemma:abs} $W(\Delta_s)$ interchanges $\alpha$ and $\beta$ if their length is equal (which is the case if we assume additionally $\Phi\neq \rB_\ell$).
Since $X_{\alpha\ssub{s}} \subseteq L_{rs}$ the argument similar to the one above implies $\U(\Sigma^-_s, I)\subseteq L_{rs}$.
This completes the proof of the theorem for $\Phi\neq \rB_\ell$. 
%TODO:
\textbf{TODO: Finish the proof for $\Phi=\rB_\ell$.}
\end{proof}
